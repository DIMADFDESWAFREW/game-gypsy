
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gypsy Full Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; background:#000; overflow:hidden; }
#game { background:#c7a96b; width:100vw; height:100vh; touch-action:none; }
.joy { position:fixed; bottom:20px; left:20px; width:120px; height:120px;
       border-radius:50%; background:rgba(255,255,255,0.1); border:2px solid rgba(255,255,255,0.3); }
.joy-inner { position:absolute; width:50px; height:50px; border-radius:50%;
             background:rgba(255,255,255,0.4); left:35px; top:35px; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div class="joy"><div class="joy-inner" id="stick"></div></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
resize(); addEventListener("resize", resize);

let player = { x:2500, y:2500, r:20 };
let coins = [];
let lastSpawn = 0;
let score = 0;
let timeLeft = 120000;
let last = performance.now();

let joy = document.querySelector(".joy");
let stick = document.getElementById("stick");
let joyActive = false, joyDX = 0, joyDY = 0;

joy.addEventListener("touchstart", e=>{ joyActive=true; });
joy.addEventListener("touchend", e=>{ joyActive=false; joyDX=0; joyDY=0; stick.style.left="35px"; stick.style.top="35px"; });
joy.addEventListener("touchmove", e=>{
  const rect = joy.getBoundingClientRect();
  const t = e.touches[0];
  const x = t.clientX - rect.left - 60;
  const y = t.clientY - rect.top - 60;
  const dist = Math.hypot(x,y);
  const max = 40;
  const nx = x/dist, ny = y/dist;
  const cl = dist>max ? max : dist;
  joyDX = nx*(cl/max);
  joyDY = ny*(cl/max);
  stick.style.left = (35 + joyDX*30)+"px";
  stick.style.top = (35 + joyDY*30)+"px";
});

function spawnCoin(){
  coins.push({
    x: 100 + Math.random()*4800,
    y: 100 + Math.random()*4800,
    t: performance.now()
  });
}

function loop(now){
  let dt = now - last;
  last = now;
  timeLeft -= dt;
  if(timeLeft <= 0){ timeLeft = 0; }

  if(now - lastSpawn > 900){
    spawnCoin();
    lastSpawn = now;
  }

  player.x += joyDX * 0.4 * dt;
  player.y += joyDY * 0.4 * dt;
  player.x = Math.max(20, Math.min(4980, player.x));
  player.y = Math.max(20, Math.min(4980, player.y));

  coins = coins.filter(c=>{
    if(now - c.t > 5000) return false;
    if(Math.hypot(player.x-c.x, player.y-c.y) < 30){
      score++;
      return false;
    }
    return true;
  });

  ctx.fillStyle="#c7a96b";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const camX = player.x - canvas.width/2;
  const camY = player.y - canvas.height/2;

  ctx.save();
  ctx.translate(-camX, -camY);

  ctx.fillStyle="gold";
  for(const c of coins){
    ctx.beginPath();
    ctx.arc(c.x, c.y, 10, 0, Math.PI*2);
    ctx.fill();
  }

  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
  ctx.fill();

  ctx.restore();

  ctx.fillStyle="white";
  ctx.font="20px sans-serif";
  ctx.fillText("Счёт: "+score, 20,30);
  ctx.fillText("Время: "+Math.floor(timeLeft/1000), 20,60);

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
