<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Gypsy — сенсорная версия</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      background:#000;
      font-family:sans-serif;
      display:flex;flex-direction:column;align-items:center;
      color:#fff;padding:20px;
    }
    #gameContainer{position:relative;}
    canvas{background:#111;border:2px solid #444;border-radius:12px;}
    #mobileControls{
      display:flex;justify-content:center;gap:20px;margin-top:20px;
    }
    .mc-btn{
      width:70px;height:70px;border-radius:50%;
      background:#ff9d00;
      display:flex;align-items:center;justify-content:center;
      font-size:32px;font-weight:bold;color:#000;
      user-select:none;touch-action:none;
    }
  </style>
</head>
<body>
  <h2>Gypsy — сенсорная версия</h2>

  <div id="gameContainer">
    <canvas id="game" width="480" height="320"></canvas>
  </div>

  <div id="mobileControls">
    <div class="mc-btn" data-dir="left">◀</div>
    <div class="mc-btn" data-dir="up">▲</div>
    <div class="mc-btn" data-dir="right">▶</div>
  </div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const width=480,height=320;

let keys={left:false,right:false,up:false};
let mobileState={left:false,right:false,up:false};

let player={x:40,y:200,w:22,h:28,vx:0,vy:0,onGround:false};

const GRAVITY=0.35,FRICTION=0.82,MOVE=0.7,JUMP=8;

function update(){
  if(keys.left||mobileState.left) player.vx-=MOVE;
  if(keys.right||mobileState.right) player.vx+=MOVE;
  if((keys.up||mobileState.up)&&player.onGround){
    player.vy=-JUMP; player.onGround=false;
  }

  player.vy+=GRAVITY;
  player.x+=player.vx;
  player.y+=player.vy;

  player.vx*=FRICTION;

  if(player.x<0)player.x=0;
  if(player.x+player.w>width)player.x=width-player.w;

  if(player.y+player.h>height){
    player.y=height-player.h;
    player.vy=0;
    player.onGround=true;
  }
}

function draw(){
  ctx.fillStyle="#0d0d15";
  ctx.fillRect(0,0,width,height);

  ctx.fillStyle="#f2c66d";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

function loop(){
  update(); draw();
  requestAnimationFrame(loop);
}
loop();

window.addEventListener("keydown",e=>{
  if(e.code==="ArrowLeft"||e.code==="KeyA")keys.left=true;
  if(e.code==="ArrowRight"||e.code==="KeyD")keys.right=true;
  if(e.code==="ArrowUp"||e.code==="KeyW"||e.code==="Space")keys.up=true;
});
window.addEventListener("keyup",e=>{
  if(e.code==="ArrowLeft"||e.code==="KeyA")keys.left=false;
  if(e.code==="ArrowRight"||e.code==="KeyD")keys.right=false;
  if(e.code==="ArrowUp"||e.code==="KeyW"||e.code==="Space")keys.up=false;
});

document.querySelectorAll(".mc-btn").forEach(btn=>{
  const dir=btn.dataset.dir;

  const start=e=>{
    e.preventDefault();
    if(dir==="left")mobileState.left=true;
    if(dir==="right")mobileState.right=true;
    if(dir==="up")mobileState.up=true;
  };

  const end=e=>{
    e.preventDefault();
    if(dir==="left")mobileState.left=false;
    if(dir==="right")mobileState.right=false;
    if(dir==="up")mobileState.up=false;
  };

  btn.addEventListener("touchstart",start);
  btn.addEventListener("touchend",end);
  btn.addEventListener("touchcancel",end);

  btn.addEventListener("mousedown",start);
  btn.addEventListener("mouseup",end);
  btn.addEventListener("mouseleave",end);
});
</script>
</body>
</html>
